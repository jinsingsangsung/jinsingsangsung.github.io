---
import { getMenu, getCollections } from "@/utils";
import { getAllPages, getDatabase } from "@/lib/notion/client";
import { MENU_PAGES_COLLECTION, HOME_PAGE_SLUG } from "@/constants";
import { slugify } from "@/utils/slugify";
import { getNavLink } from "@/lib/blog-helpers";

const pages = await getAllPages();
const collections = await getCollections();
const database = await getDatabase();
const menuLinks = await getMenu();

// Get all posts to check Gallery collection content
import { getAllPosts } from "@/lib/notion/client";
const posts = await getAllPosts();

const galleryPosts = posts.filter(post => post.Collection === 'Gallery');

// Filter pages that might be Gallery-related
const galleryPages = pages.filter(page => 
  page.Title.toLowerCase().includes('gallery') || 
  page.Slug.toLowerCase().includes('gallery') ||
  page.Collection?.toLowerCase().includes('gallery')
);
---

<html>
<head>
    <title>Gallery Debug Info</title>
    <style>
        body { font-family: monospace; padding: 20px; }
        .section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; }
        pre { background: #f5f5f5; padding: 10px; overflow-x: auto; }
        .highlight { background: yellow; }
    </style>
</head>
<body>
    <h1>Gallery Debug Information</h1>
    
    <div class="section">
        <h2>Configuration</h2>
        <pre>MENU_PAGES_COLLECTION: {MENU_PAGES_COLLECTION}
HOME_PAGE_SLUG: {HOME_PAGE_SLUG}</pre>
    </div>

    <div class="section">
        <h2>Database Info</h2>
        <pre>Database Title: {database.Title}
Database Description: {database.Description}</pre>
    </div>

    <div class="section">
        <h2>All Collections</h2>
        <pre>{JSON.stringify(collections, null, 2)}</pre>
    </div>

    <div class="section">
        <h2>Gallery Collection Posts</h2>
        <pre>{JSON.stringify(galleryPosts.map(p => ({
            Title: p.Title,
            Slug: p.Slug,
            Collection: p.Collection,
            Published: p.Published
        })), null, 2)}</pre>
    </div>

    <div class="section">
        <h2>Gallery-Related Pages</h2>
        <pre>{JSON.stringify(galleryPages.map(p => ({
            Title: p.Title,
            Slug: p.Slug,
            Collection: p.Collection,
            Rank: p.Rank,
            Published: p.Published
        })), null, 2)}</pre>
    </div>

    <div class="section">
        <h2>All Pages Summary</h2>
        <pre>{JSON.stringify(pages.map(p => ({
            Title: p.Title,
            Slug: p.Slug,
            Collection: p.Collection,
            Rank: p.Rank
        })), null, 2)}</pre>
    </div>

    <div class="section">
        <h2>Generated Menu Links</h2>
        <pre>{JSON.stringify(menuLinks, null, 2)}</pre>
    </div>

    <div class="section">
        <h2>Gallery Analysis</h2>
        <p><strong>Gallery Collection URL:</strong> /collections/{slugify('Gallery')} = /collections/{slugify('Gallery')}</p>
        <p><strong>Gallery Posts Count:</strong> {galleryPosts.length}</p>
        
        {galleryPosts.length === 1 && (
            <div class="highlight">
                <p><strong>SINGLE POST REDIRECT:</strong> The Gallery collection has only 1 post, so it will redirect to:</p>
                <pre>/{galleryPosts[0].Slug}</pre>
                <p><strong>But this is a POST, not a PAGE! Posts are served from:</strong></p>
                <pre>/posts/{galleryPosts[0].Slug}</pre>
            </div>
        )}
        
        {galleryPosts.length === 0 && (
            <div class="highlight">
                <p><strong>NO POSTS FOUND:</strong> The Gallery collection has no posts!</p>
            </div>
        )}
        
        {galleryPages.length > 0 && (
            <p><strong>Gallery Page Found:</strong> /{galleryPages[0].Slug}</p>
        )}
        
        <div class="highlight">
            <p><strong>SOLUTION:</strong> The Gallery tab should point to:</p>
            <pre>/posts/gallery</pre>
            <p>Or convert the Gallery post to a Gallery page in Notion.</p>
        </div>
    </div>
</body>
</html>